â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                 UBUNTU SERVER SETUP STAPPENPLAN                          â•‘
â•‘                    Voor SOAR Failed Login Monitoring                     â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ STAP 1: SSH naar je Ubuntu Server
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

    # Gebruik de SSH terminal in VS Code of:
    ssh ubuntu@<IP-ADRES>


ğŸ”§ STAP 2: Installeer Dependencies
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

    sudo apt update
    sudo apt install awscli jq -y

    # Verificatie:
    aws --version    # Moet AWS CLI versie tonen
    jq --version     # Moet jq versie tonen


ğŸ”‘ STAP 3: Configureer AWS Credentials
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

    aws configure

    Vul in:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ AWS Access Key ID: <JE ACCESS KEY>                        â”‚
    â”‚ AWS Secret Access Key: <JE SECRET KEY>                    â”‚
    â”‚ Default region name: eu-central-1                         â”‚
    â”‚ Default output format: json                               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    # Test de verbinding:
    aws sts get-caller-identity --region eu-central-1

    âœ… Als het werkt, zie je je AWS Account ID en User ARN


âœ… STAP 4: Test EventBridge Access
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

    # Check of je EventBridge kunt benaderen
    aws events list-event-buses --region eu-central-1

    # Stuur een test event
    aws events put-events \
      --entries '[{
        "Source": "custom.security",
        "DetailType": "Test Event",
        "Detail": "{\"test\":\"true\"}",
        "EventBusName": "default"
      }]' \
      --region eu-central-1

    âœ… Als het werkt, zie je: "FailedEntryCount": 0


ğŸ“ STAP 5: Kopieer Monitoring Script naar Server
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

    OPTIE A: SCP vanaf je Windows machine
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # In PowerShell op Windows:
    scp scripts\ubuntu-monitor-failed-logins.sh ubuntu@<IP>:~/

    # Dan op Ubuntu server:
    sudo mv ~/ubuntu-monitor-failed-logins.sh /usr/local/bin/monitor-failed-logins.sh


    OPTIE B: Handmatig kopiÃ«ren
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # Op Ubuntu server:
    sudo nano /usr/local/bin/monitor-failed-logins.sh
    
    # Plak de inhoud van scripts/ubuntu-monitor-failed-logins.sh
    # Save met: Ctrl+O, Enter, Ctrl+X


    # Maak executable:
    sudo chmod +x /usr/local/bin/monitor-failed-logins.sh


ğŸ§ª STAP 6: Test Script Handmatig
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

    # Start het script (laat draaien)
    sudo /usr/local/bin/monitor-failed-logins.sh

    Je moet zien:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ğŸ” Starting Ubuntu Failed Login Monitor...      â”‚
    â”‚ Monitoring: /var/log/auth.log                   â”‚
    â”‚ Region: eu-central-1                            â”‚
    â”‚ âœ… AWS CLI en jq gevonden                       â”‚
    â”‚ âœ… Log file gevonden                            â”‚
    â”‚ ğŸš€ Start monitoring...                          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


ğŸ”¥ STAP 7: Trigger een Failed Login (Test)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

    # Open een TWEEDE SSH terminal naar dezelfde server
    # Probeer in te loggen met verkeerd wachtwoord:
    ssh testuser@localhost
    # Type een verkeerd wachtwoord (3x)

    # In de EERSTE terminal (waar script draait) moet je zien:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ğŸš¨ Failed login detected:                       â”‚
    â”‚    Time: 2025-10-23T15:30:00Z                   â”‚
    â”‚    User: testuser                               â”‚
    â”‚    IP: 127.0.0.1                                â”‚
    â”‚    ğŸ“¤ Sending to EventBridge...                 â”‚
    â”‚    âœ… Event sent successfully!                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    âœ… Als je dit ziet, WERKT HET! ğŸ‰


âš™ï¸ STAP 8: Configureer als Systemd Service (Automatisch starten)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

    # Stop het handmatige script eerst (Ctrl+C)

    # Maak service file
    sudo nano /etc/systemd/system/failed-login-monitor.service

    # Plak:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ [Unit]                                                      â”‚
    â”‚ Description=Ubuntu Failed Login Monitor for AWS SOAR       â”‚
    â”‚ After=network.target                                       â”‚
    â”‚                                                             â”‚
    â”‚ [Service]                                                   â”‚
    â”‚ Type=simple                                                 â”‚
    â”‚ User=root                                                   â”‚
    â”‚ ExecStart=/usr/local/bin/monitor-failed-logins.sh         â”‚
    â”‚ Restart=always                                              â”‚
    â”‚ RestartSec=10                                               â”‚
    â”‚ StandardOutput=journal                                      â”‚
    â”‚ StandardError=journal                                       â”‚
    â”‚                                                             â”‚
    â”‚ [Install]                                                   â”‚
    â”‚ WantedBy=multi-user.target                                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    # Save: Ctrl+O, Enter, Ctrl+X

    # Activeer de service:
    sudo systemctl daemon-reload
    sudo systemctl enable failed-login-monitor.service
    sudo systemctl start failed-login-monitor.service

    # Check status:
    sudo systemctl status failed-login-monitor.service

    âœ… Status moet "active (running)" zijn


ğŸ“Š STAP 9: Verificatie in AWS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

    # Op je Windows machine of Ubuntu server:

    # Check of event in DynamoDB staat
    aws dynamodb scan \
      --table-name soar-dev-events \
      --region eu-central-1 \
      --max-items 5

    # Check Lambda logs
    aws logs tail /aws/lambda/soar-dev-parser \
      --region eu-central-1 --since 10m

    # Of gebruik de test scripts:
    bash scripts/check-soar-health.sh


ğŸ“§ STAP 10: Check SNS Notifications
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

    # Als severity HIGH is, moet je een email ontvangen
    # Check je email inbox (ook spam folder!)

    âœ… Je zou een email moeten krijgen met subject:
       "Security Alert - HIGH - failed_login"


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ¯ HANDIGE COMMANDO'S VOOR MONITORING
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

    # Service logs bekijken (live)
    sudo journalctl -u failed-login-monitor.service -f

    # Laatste 50 regels van service logs
    sudo journalctl -u failed-login-monitor.service -n 50

    # Auth log bekijken (waar failed logins staan)
    sudo tail -f /var/log/auth.log

    # Service herstarten
    sudo systemctl restart failed-login-monitor.service

    # Service stoppen
    sudo systemctl stop failed-login-monitor.service

    # Service starten
    sudo systemctl start failed-login-monitor.service


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âŒ TROUBLESHOOTING
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

    PROBLEEM: "AWS CLI niet gevonden"
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    sudo apt install awscli -y


    PROBLEEM: "Permission denied" bij EventBridge
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # Check credentials:
    aws sts get-caller-identity --region eu-central-1
    
    # Herconfig:
    aws configure


    PROBLEEM: Events komen niet aan in AWS
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # 1. Check service draait:
    sudo systemctl status failed-login-monitor.service

    # 2. Check logs voor errors:
    sudo journalctl -u failed-login-monitor.service -n 100

    # 3. Test AWS handmatig:
    aws events put-events \
      --entries '[{"Source":"test","DetailType":"test","Detail":"{}"}]' \
      --region eu-central-1


    PROBLEEM: Script crasht steeds
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # Check logs:
    sudo journalctl -u failed-login-monitor.service -n 100

    # Test script handmatig:
    sudo /usr/local/bin/monitor-failed-logins.sh


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… CHECKLIST
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

    [ ] SSH verbinding met Ubuntu server
    [ ] AWS CLI geÃ¯nstalleerd (aws --version werkt)
    [ ] jq geÃ¯nstalleerd (jq --version werkt)
    [ ] AWS credentials geconfigureerd (aws sts get-caller-identity werkt)
    [ ] EventBridge toegang getest (aws events list-event-buses werkt)
    [ ] Script gekopieerd naar /usr/local/bin/monitor-failed-logins.sh
    [ ] Script is executable (chmod +x)
    [ ] Script handmatig getest (zie output)
    [ ] Failed login test gedaan (zie event in output)
    [ ] Systemd service file aangemaakt
    [ ] Service enabled (sudo systemctl enable)
    [ ] Service started (sudo systemctl start)
    [ ] Service status is "active (running)"
    [ ] Event verschijnt in AWS DynamoDB
    [ ] Lambda functions verwerken event (check logs)
    [ ] SNS notificatie ontvangen (bij HIGH severity)


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ‰ Als alle stappen werken, heb je een VOLLEDIG WERKEND SOAR SYSTEEM! ğŸ‰

De flow is:
Ubuntu Failed Login â†’ EventBridge â†’ SQS â†’ Parser Lambda â†’ Engine Lambda
                                                              â†“
                                                         (Bij HIGH severity)
                                                              â†“
                                                         Notify Lambda â†’ SNS Email

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
